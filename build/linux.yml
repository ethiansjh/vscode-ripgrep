parameters:
  target: ''
  gcc_version: ''
  rust_versin: ''

steps:
- template: clone_ripgrep.yml
- script: build/install.sh
  env:
    RUST_VERSION: ${{ parameters.rust_version }}
    TARGET: ${{ parameters.target }}
  displayName: Install Rust
- script: ../build/script.sh
  workingDirectory: ripgrep
  env:
    TARGET: ${{ parameters.target }}
  displayName: Build
  condition: ne( variables['Agent.OS'], 'Windows_NT' )
- task: GitHubRelease@0
  inputs:
    gitHubConnection: GitHub
    repositoryName: '$(Build.Repository.Name)'
    action: 'create'
    target: '$(Build.SourceVersion)'
    tagSource: 'auto'
    assets: '$(Build.ArtifactStagingDirectory)/*'
    isDraft: true
